---
layout: post
title: Debian Linux Cheat Sheet III [Active Directory Integration]
date: 2023-12-11 02:16
author: theguler
comments: true
categories: [Debian]
---
<!-- wp:image {"lightbox":{"enabled":true},"id":9880,"width":"421px","height":"auto","sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large is-resized"><img src="https://theguler.wordpress.com/wp-content/uploads/2023/11/debian_dragon-1.jpg?w=1024" alt="" class="wp-image-9880" style="width:421px;height:auto" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>🔥🔑Directory Services <strong>Join</strong></strong> / <strong>Authentication:</strong></p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted"><strong>Directory Services Join / Authentication:<br>----------------------------------------|</strong><br><strong>Directory Services: Active Directory<br>OS: Debian GNU/Linux 12 (bookworm) x86_64<br>Kernel: 6.1.0-14-amd64<br>Shell: bash 5.2.15<br>Domain: guler.com<br>Server Ip: 10.x.x.x</strong><br><br><strong>Prepare the Network<br>-------------------------------------------------|</strong><br><strong>UDP/TCP 135:</strong> Domain controller intercommunication<br><strong>UDP 138; TCP 139:</strong> File Replication Service (FRS)<br><strong>UDP/TCP 389:</strong> Lightweight Directory Access Protocol (LDAP)<br><strong>UDP/TCP 636: </strong>Lightweight Directory Access Protocol (LDAP) TLS/SSL <br><strong>UDP/TCP 445:</strong> FRS<br><strong>UDP/TCP 464:</strong> Kerberos password change<br><strong>TCP 3268,3269:</strong> Global catalog (GC)<br><strong>UDP/TCP 53:</strong> Domain Name System (DNS)<br><br><strong>#Setup Info:</strong><br>hostnamectl<br>hostname<br>hostname --domain<br>sudo cat /etc/resolv.conf  <strong>#DNS FILE</strong><br>sudo cat /etc/hosts  <strong>#HOST FILE</strong></pre>
<!-- /wp:preformatted -->

<!-- wp:image {"lightbox":{"enabled":true},"id":10143,"width":"412px","height":"auto","sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large is-resized"><img src="https://theguler.wordpress.com/wp-content/uploads/2023/12/join_debian.png?w=645" alt="" class="wp-image-10143" style="width:412px;height:auto" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>#Required Packages</strong></p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted"><strong>#Required Packages</strong><br>sudo apt update<br>sudo apt upgrade<br>sudo apt -y install realmd libnss-sss libpam-sss sssd sssd-tools adcli samba-common-bin oddjob oddjob-mkhomedir packagekit<br><br><strong>#Active Directory Explore, Participate, Complete:</strong><br>sudo realm discover guler.com --verbose<br>sudo realm join guler.com<br>sudo realm join -U john guler.com<br>sudo realm join -v guler.com<br>sudo realm list<br><br><strong>#Time Synchronization (NTP)</strong><br><strong>✅</strong> S<strong>ervice: systemd-timesyncd services</strong><br><strong>-----------------------------------------|</strong><br>sudo nano /etc/systemd/timesyncd.conf<br>sudo systemctl enable systemd-timesyncd<br>sudo systemctl start systemd-timesyncd<br>sudo systemctl status systemd-timesyncd<br><br><strong>#sssd.conf Edit-View:</strong><br>sudo cat /etc/sssd/sssd.conf<br>sudo nano /etc/sssd/sssd.conf<br>sudo systemctl restart sssd<br>systemctl status sssd<br><br><strong>***From the "sssd" configurations file:<br>----------------------------------------------|</strong><br><strong>+</strong> The cache_credentials setting is set to True. Thus, a user can still log in even if the Active Directory is unavailable.<br><br><strong>+</strong> The fallback_homedir is /home/%u@%d. For example, a user will have a home directory of /home/user@domain.<br><br><strong>+</strong> The use_fully_qualified_names is set to True. As a result, users must log in using the format user@domain.<br><strong>----------------------------------------------|</strong><br><br><strong>#(PAM) <strong>Pluggable Authentication Modules "configurations file</strong></strong>" <strong>düzenle:</strong><br>sudo nano /etc/pam.d/common-session<br><br><strong>✅🛡️ Sistemde her userin "/Home/username" oluştur ve "özel" yetkilerini ver.</strong><br>session optional        pam_mkhomedir.so skel=/etc/skel umask=0077<br><br><strong>#PAM(Pluggable Authentication Modules) (Spesifik) tekrar güncelle:</strong><br>sudo pam-auth-update<br><br><strong>📝🔑SSD Consider using SSL/TLS to encrypt LDAP traffic. <br>-------------------------------------------------------|</strong><br><strong>#SSSD.conf path:</strong><br>sudo nano /etc/sssd/sssd.conf<br><br><strong>#SSSD.conf Edit:<br></strong>[domain/guler.com]<br>ldap_uri = ldaps://anatolia.guler.com<br>ldap_tls_reqcert = demand<br>ldap_tls_cacert = /etc/ssl/certs/ca-certificates.crt<br><br><strong>##LDAP Encryption SSL/TLS Remote Test #Status: Verify return code: 0 (ok)</strong><br>openssl s_client -connect anatolia.guler.com:636 -showcerts<br><br><strong>#SSSD Restart-Status:</strong><br>sudo systemctl restart sssd<br>sudo systemctl status sssd<br><br><strong>#Login Verify:</strong><br>getent passwd ahmet.s@guler.com<br>id ahmet.s@guler.com<br><br><strong>#User Login:</strong><br>sudo login<br>su ahmet.s@guler.com<br><br><strong>#SSSD (System Security Services Daemon) yapılandır <strong>(Edit)</strong>:</strong><br>sudo nano /etc/sssd/sssd.conf<br><br><strong>#SSSD nitelikli kullanıcı adları(fully qualified) kullan True - False:</strong><br>use_fully_qualified_names = False<br><br><strong>#SSSD servisini yeniden başlat:</strong><br>sudo systemctl restart sssd<br><br><strong>#SSSD'nin LDAP kullanıcı ve gruplarını UNIX kimlikleriyle eşleştir:</strong><br>#sudo nano /etc/sssd/sssd.conf<br><br><strong>#Add File:</strong><br>ldap_id_mapping = False #LDAP serverin kullanılabilirliğine bağımlı olma<br>ldap_id_mapping = True  #LDAP serverin kullanılabilirliğine bağımlı ol<br><br><strong>#SSSD (System Security Services Daemon) Cache Clear % Restart</strong><br>sudo rm -f /var/lib/sss/db/*<br>sudo systemctl restart sssd<br><br><strong><strong>✅</strong>🛡️ Access Control – User/group limitations:</strong><br><strong><strong>🛡️</strong></strong>Kullanıcının SSH ve konsol aracılığıyla erişimine izin ver:<br>sudo realm permit ahmet.s@guler.com<br><br><strong>#Allow/Deny access to group:</strong><br>sudo realm permit -g LinuxAdmins<br>sudo realm deny -g LinuxAdmins<br><br>sudo realm permit g 'Security Users'<br>sudo realm permit -g 'Domain Users' 'admin users'<br>sudo realm permit -g LinuxAdmins@guler.com<br><br><strong>#Tüm kullanıcılar/gruplar erişimine İzin ver - Reddet:</strong><br>sudo realm permit --all<br>sudo realm deny --all<br><br><strong>#Sudo Erişimini Yapılandır:</strong><br><strong><strong>🛡️</strong>Varsayılan olarak Etki Alanı kullanıcılarının "root'a yükselme izni" yoktur.</strong><br>sudo nano /etc/sudoers.d/linux-admins<br><br><strong>#sudoers file Edit:</strong><br>sudo visudo<br><br><strong>#Add File:</strong><br>%LinuxAdmins@guler.com ALL=(ALL) ALL<br>ahmet.s@guler.com ALL=(ALL) ALL</pre>
<!-- /wp:preformatted -->
