---
layout: post
title: Commonly used PowerShell commands on Active Directory
date: 2022-03-12 21:43
author: theguler
comments: true
categories: [Active Directory]
---
<!-- wp:image {"id":2270,"width":"452px","height":"248px","sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large is-resized"><img src="https://theguler.wordpress.com/wp-content/uploads/2022/03/ad.jpg?w=704" alt="" class="wp-image-2270" style="width:452px;height:248px" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>PS:</strong></p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre id="block-212c4770-1090-40f9-a3aa-882bb19bd474" class="wp-block-preformatted"><strong>#Turn on/off protection against accidental deletion</strong><br>Get-ADObject -Filter * -SearchBase "OU=Testbilgisayarlar,DC=guler,DC=com" | ForEach-Object -Process {Set-ADObject -ProtectedFromAccidentalDeletion $false -Identity $_}<br><br><br><strong>#List ExtensionAttribute values in user accounts</strong><br>Get-ADUser -Filter {extensionAttribute1 -notlike "*"} -SearchBase "DC=Guler,DC=com" | select name,samaccountname | Export-Csv -path "C:\extensionAttributes.csv"<br>Get-ADUser -Filter {extensionAttribute10 -notlike "*"} -SearchBase "DC=Guler,DC=com" | select name,samaccountname | Export-Csv -path "C:\extensionAttribute10.csv"<br><br><strong>#AD List all Users</strong><br>Get-ADUser -Filter * -Properties Name,SamAccountName,LastLogonDate | Sort | Select Name,SamAccountName,LastLogonDate,Enabled | Export-Csv "C:\allusers.csv"<br> <br><strong>#Find all users who have not logged in</strong><br>Get-ADUser -Filter {(lastlogontimestamp -notlike "*")} | Select SamAccountName,Name<br><br><strong>#Find user accounts that are enabled but have never opened an account</strong><br>Get-ADUser -Filter {(lastlogontimestamp -notlike "*") -and (enabled -eq $true)} | Select SamAccountName,Name<br><br> <br><strong>#Fetch accounts that have not logged in for 90 days</strong><br>$days = 90<br>$createdtime = (Get-Date).Adddays(-($days))<br>Get-ADUser -Filter {(lastlogontimestamp -notlike "*") -and (enabled -eq $true) -and (whencreated -lt $createdtime)} | Select SamAccountName,Name<br> <br><strong>#Find accounts that have not logged in for 30 days</strong><br>$createdtime = (Get-Date).Adddays(-(30))<br>Get-ADUser -Filter {(lastlogontimestamp -notlike "*") -and (enabled -eq $true) -and (whencreated -lt $createdtime)} | Select Name,DistinguishedName |Export-CSV "C:\30_NeverLoggedOnUsers.csv" -NoTypeInformation -Encoding UTF8<br> <br><strong>#Enable and list those who have not logged in for 90 days</strong><br>Get-ADUser -Filter {Enabled -eq $TRUE} -Properties Name,SamAccountName,LastLogonDate,Enabled | Where {($_.LastLogonDate -lt (Get-Date).AddDays(-90)) -and ($_.LastLogonDate -ne $NULL)} | Sort | Select Name,SamAccountName,LastLogonDate,Enabled | Export-Csv "C:\enable-90gun-oturum-acmayanlar.csv"<br> <br><strong>#Enable and list those who have never logged in<br></strong>Get-ADUser -Filter {Enabled -eq $TRUE} -Properties Name,SamAccountName,LastLogonDate,Enabled | Where {($_.LastLogonDate -eq $NULL)} | Sort | Select Name,SamAccountName,LastLogonDate,Enabled | Export-Csv "C:\Enable_account_and_never_Login.csv"<br><br><strong>#Find Disabled Users who have never logged in</strong><br>Get-ADUser -Filter {Enabled -eq $FALSE} -Properties Name,SamAccountName,LastLogonDate,Enabled | Where {($_.LastLogonDate -eq $NULL)} | Sort | Select Name,SamAccountName,LastLogonDate,Enabled | Export-Csv "C:\newer_login_and_disable_users1.csv"<br> <br><strong>#Find Disabled users who have been disabled (logoned) in the last 180 days</strong><br>Get-ADUser -Filter {Enabled -eq $FALSE} -Properties Name,SamAccountName,LastLogonDate,Enabled | Where {($_.LastLogonDate -lt (Get-Date).AddDays(-180)) -and ($_.LastLogonDate -ne $NULL)} | Sort | Select Name,SamAccountName,LastLogonDate,Enabled | Export-Csv "C:\180_days_disabled.csv"<br> <br><strong>#Find all Disabled Users</strong><br>Get-ADUser -Filter {Enabled -eq $FALSE} -Properties Name,SamAccountName,LastLogonDate,Enabled | Sort | Select Name,SamAccountName,LastLogonDate,Enabled | Export-Csv "C:\all_disable_users.csv"<br> <br><strong>#AD Find All Computers</strong><br>Get-ADComputer -Filter * -Properties OperatingSystem, LastLogonDate | Sort | Select Name,OperatingSystem,LastLogonDate,Enabled| Export-Csv "C:\allcomputers.csv"<br> <br><strong>#Enable Computers and find those that have not been logged in for 30 days</strong><br>Get-ADComputer -Filter {Enabled -eq $TRUE} -Properties OperatingSystem, LastLogonDate | Where { $_.LastLogonDate -lt (Get-Date).AddDays(-30) } | Sort | Select Name,OperatingSystem,LastLogonDate,Enabled| Export-Csv "C:\inactivecomputers1.csv"<br> <br><strong>#Enable Computers and find those that have never been logged in</strong><br>Get-ADComputer -Filter {Enabled -eq $TRUE} -Properties OperatingSystem, LastLogonDate | Where { ($_.LastLogonDate -eq $NULL) }| Sort | Select Name,OperatingSystem,LastLogonDate,Enabled| Export-Csv "C:\enable_and_NeverLoginComp.csv"<br> <br><strong>#All Disable Computers</strong><br>Get-ADComputer -Filter {Enabled -eq $FALSE} -Properties OperatingSystem, LastLogonDate | Sort | Select Name,OperatingSystem,LastLogonDate,Enabled| Export-Csv "C:\disabled_computers.csv"<br><br><br><strong>#All about Domain Controllers - Whoami</strong><br>$domain = [System.Directoryservices.Activedirectory.Domain]::GetCurrentDomain()<br>$domain | ForEach-Object {$_.DomainControllers} | <br>ForEach-Object {<br>  $hostEntry= [System.Net.Dns]::GetHostByName($_.Name)<br>  New-Object -TypeName PSObject -Property @{<br>      Name = $_.Name<br>      IPAddress = $hostEntry.AddressList[0].IPAddressToString<br>     }<br>} | Export-CSV "C:\domaincontrollers.csv" -NoTypeInformation -Encoding UTF8<br> <br><strong>#Find DHCP Servers</strong><br>netsh dhcp show server | Export-Csv "C:\alldhcpserverlist.csv"<br> <br><strong>#Move user to a different OU</strong><br>Get-ADUser $name| Move-ADObject -TargetPath 'OU=users,DC=Guler,Dc=com'<br>Get-ADUser “faruk” | Move-ADObject -TargetPath “OU=Uyeler,DC=Guler,DC=com” <br> <br><strong>#Get total number of users</strong><br>(Get-ADUser -filter *).count<br> <br><strong>#Get the number of computers in Active Directory</strong><br>(Get-ADComputer -Filter *).Count<br> <br><strong>#Find the number of users in a particular OU</strong><br>(Get-ADUser -filter * -searchbase "OU=personel, OU=uyeler, DC=Guler, DC=com").count<br> <br><strong>#Get the number of enabled users</strong><br>(Get-AdUser -filter * |Where {$_.enabled -eq "True"}).count<br> <br><strong>#Get the number of disabled users</strong><br>(Get-ADUser -filter * |Where {$_.enabled -ne "False"}).count<br> <br><strong>#Get the number of users in the group</strong><br>(Get-ADGroupMember -Identity "Group Name").count<br> <br><strong>#List Shared Mailboxes on Exchange Server</strong><br>Get-Recipient -Resultsize unlimited | where {$_.RecipientTypeDetails -eq "SharedMailbox"} | ft Name,Manager &gt;C:\shared_mailboxes.csv<br> <br><strong>#List Contacts in Exchange Server</strong><br>Get-Recipient -Resultsize unlimited | where {$_.RecipientTypeDetails -eq "Contacts"} | ft Name,Manager &gt;C:\all_contacts.csv<br> <br><strong>#Deleting a specific User</strong><br>#Remove-ADUser -identity "faruk"  -Confirm:$False<br> <br><strong>#Find Computers Inactive for 100 days</strong><br>$DaysInactive = 100<br>$time = (Get-Date).Adddays(-($DaysInactive))<br>Get-ADComputer -Filter {LastLogonTimeStamp -lt $time} -ResultPageSize 99999 -resultSetSize $null -Properties Name, OperatingSystem, SamAccountName, DistinguishedName | select Name</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p><strong>Saygılarımla – Best Regards</strong></p>
<!-- /wp:paragraph -->
